@page "{handler?}/{id?}"
@model Blog.Pages.IndexModel

@{
    ViewData["Title"] = "Home";
}

@if (await Model.Permissions.CanCreatePostAsync())
{
    <span>You can <a asp-page="/PostCreate">create</a> your own post!</span>
    <hr />
}

@foreach (var post in Model.Posts.OrderByDescending(p => p.CreationTime).Take(10))
{
<div style="margin: 5px 0 5px 0">
    <a asp-page="/Post" asp-route-id="@post.Id">@post.Title</a>
    <a asp-page="/Account/Profile" asp-route-id="@post.Author.Id">@post.Author.UserName</a>
    @post.CreationTime.ToString("dd.MM.yyyy")
    @{ await Html.RenderPartialAsync("_PostBodyView", new PostViewModel(post, true)); }
</div>
}

@{
    const int MAX = 3;
    const int SIDE_LENGTH = (MAX - 1) / 2;
    var addStartElipsis = Model.CurrentPage - SIDE_LENGTH - 1 > 0;
    var addEndElipsis = Model.NumOfPages - 1 - (Model.CurrentPage + SIDE_LENGTH) > 1;
}

@if (Model.CurrentPage > 0)
{
    <a asp-page="/Index" asp-route-pageIndex="@(Model.CurrentPage - 1)">@('<')</a>
}
<a asp-page="/Index" asp-route-pageIndex="0">1</a>
@if (addStartElipsis)
{
    <span>...</span>
}
@foreach (var i in MAX.Range().Select(i => i + Model.CurrentPage - SIDE_LENGTH).Where(i => i < Model.NumOfPages - 1).SkipNegative())
{
    <a asp-page="/Index" asp-route-pageIndex="@i">@(i + 1)</a>
}
@if (addEndElipsis)
{
    <span>...</span>
}
@if (Model.NumOfPages > 1)
{
    <a asp-page="/Index" asp-route-pageIndex="@Model.NumOfPages.Add(-1)">@Model.NumOfPages</a>
}
@if (Model.CurrentPage < Model.NumOfPages - 1)
{
    <a asp-page="/Index" asp-route-pageIndex="@(Model.CurrentPage + 1)">></a>
}