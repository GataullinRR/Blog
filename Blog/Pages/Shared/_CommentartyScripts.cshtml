<script>
    $(document).ready(function () {
        var commentaries = document.getElementsByClassName("commentary-container");
        for (var i = 0; i < commentaries.length; i++) {
            var container = commentaries[i];
            var id = container.getAttribute("commentary-id");
            loadCommentary(container, id);
        }
    });

    function loadCommentary(container, commentaryId) {
        loadView('/Commentary/GetCommentaryAsync?id=' + commentaryId, function () {
            container.getElementsByClassName("commentary-edit-button")[0].addEventListener('click', function () {
                loadView('/Commentary/GetCommentaryEditAsync?id=' + commentaryId, function () {
                    container.getElementsByClassName("commentary-edit-exit-button")[0].addEventListener('click', function () {
                        loadCommentary(container, commentaryId);
                    })
                });
            })
        });

        function loadView(route, onLoaded) {
            makeRequest(route, "get", function (response) {
                container.innerHTML = response;
                onLoaded();
            });
        }
    }

    @{
        var target = new ControllerAction(nameof(ReportingController), nameof(ReportingController.ReportCommentaryAsync));
    }

    function reportCommentary(element, id) {
        report(element, "@target.GetURI()", id);
        @*makePost("@target.GetURI()", { "id": id }, true,
            function () {
                renderMessage("Report has been submitted");
                var reportButton = element.parentElement.closest(".btn-report");
                reportButton.parentElement.removeChild(reportButton);
            },
            reportError
        );

        function reportError() {
            renderMessage("An error occurred during submitting the report :(");
        }*@
    }
</script>